(function(){var d;function c(a){var b=$("#debugpane");if(!b.get(0)){b=$(document.createElement("div"));b.get(0).id="debugpane";b.appendTo(document.body)}else{b.append("<br>")}b.append(a);if(d){clearTimeout(d)}d=setTimeout(function(){d=null;b.remove()},5000);b.click(function(){b.remove()})}window.showDebugMessage=c;console.log=c})();(function(n){var o=n.nanomaps;var r,l,h,d=new o.ImgMarker({src:"orb_blue.png"}),k=new o.ImgMarker({src:"pin_pink.png"}),c=new o.EllipseMarker({className:"errorHalo",unit:"m"});var i={street:new o.TileLayer({tileSrc:"http://otile${modulo:1,2,3}.mqcdn.com/tiles/1.0.0/osm/${level}/${tileX}/${tileY}.png"}),sat:new o.TileLayer({tileSrc:"http://oatile${modulo:1,2,3}.mqcdn.com/naip/${level}/${tileX}/${tileY}.jpg"}),hyb:new o.TileLayer({tileSrc:"http://otile${modulo:1,2,3}.mqcdn.com/tiles/1.0.0/hyb/${level}/${tileX}/${tileY}.png"})};function a(s){if(s==="street"){r.detach(i.sat);r.detach(i.hyb);r.attach(i.street)}else{if(s==="aerial"){r.detach(i.street);r.attach(i.sat);r.attach(i.hyb)}}}function b(){var s=$("#map").get(0);var v=window.devicePixelRatio||1,u=0;if(v>1.5){u=-0.5}r=new o.MapSurface(s,{zoomBias:u});r.on("motion.longtap",function(w){var x=r.getLocation(w.x,w.y);showDebugMessage("Long tap: "+x.lat()+","+x.lng());w.handled=true});r.on("motion.click",function(w){if(w.count===1){var x=r.getLocation(w.x,w.y);showDebugMessage("Single tap: "+x.lat()+","+x.lng()+", Zoom="+r.getZoom());w.handled=true}});try{navigator.geolocation.getCurrentPosition(m,j,{maximumAge:Infinity,timeout:2000});setTimeout(function(){g()},2500)}catch(t){g()}f();e()}function f(){$("#zoomControl .zoomIn").click(function(){r.begin();r.zoomIn();r.commit(true)});$("#zoomControl .zoomOut").click(function(){r.begin();r.zoomOut();r.commit(true)});$("#btnStreet").click(function(){a("street")});$("#btnAerial").click(function(){a("aerial")})}function e(){$("#btnQuery").click(function(){var s=$("#txtQuery").val();p(s)})}function p(w){var y={format:"json",q:w,bounded:0,},u="http://open.mapquestapi.com/nominatim/v1/search",t,s,x=true;$.ajax({url:u,dataType:"json",jsonp:"json_callback",data:y,success:function(v){if(v.length==0){alert("No results found.");return}var z=v[0],B=Number(z.lat),A=Number(z.lon);k.setLocation({lat:B,lng:A});r.attach(k);r.begin();r.setLocation({lat:B,lng:A});r.setZoom(10);r.commit({})}})}function q(){r.setSize()}function g(s,t){if(l){return}if(!s){s={lat:47.604317,lng:-122.329773}}if(t){r.setZoom(t)}r.setLocation(s);a("street");l=true}function m(s){var t={lat:s.coords.latitude,lng:s.coords.longitude};g(t,13);c.settings.latitude=t.lat;c.settings.longitude=t.lng;c.settings.radius=s.coords.accuracy;r.update(c);d.setLocation(t);r.update(d);if(!h){h=navigator.geolocation.watchPosition(m,j)}}function j(s){console.log("Could not get location: "+s.message);g()}$(window).load(b);$(window).resize(q)})(window);